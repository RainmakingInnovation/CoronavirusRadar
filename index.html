<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Dashboard</title>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/spin.js/2.0.1/spin.min.js"></script>
    <script src="https://cdn.rawgit.com/eligrey/canvas-toBlob.js/f1a01896135ab378aa5c0118eadd81da55e698d8/canvas-toBlob.js"></script>
    <script src="https://cdn.rawgit.com/eligrey/FileSaver.js/e9d941381475b5df8b7d7691013401e171014e89/FileSaver.min.js"></script>
        <script
      src="https://kit.fontawesome.com/ea2379d57d.js"
      crossorigin="anonymous"
    ></script>
    <link rel="icon" href="assets/favicon.ico">
    <style type="text/css">
      body {
        display: grid;
        grid-template-columns: 146px 800px 160px 200px;
        grid-template-rows: 300px 120px 400px;
        grid-gap: 0.1em;
        margin: auto;
      }

      #chart-container {
        grid-column: 2 / span 1;
        grid-row: 1 / span 2;
        padding: 5px;
      }

      #key-container {
        grid-column: 3 / span 1;
        grid-row: 2 / span 1;
        overflow: hidden;
      }

      #control-container {
        grid-column: 3 / span 1;
        grid-row: 3 / span 1;
        overflow: hidden;
        padding: 10px 20px;
        text-align: center;
      }

      #hover-info-container {
        grid-column: 4 / span 1;
        grid-row: 2 / span 2;
        overflow: hidden;
        padding: 5px;
      }

      #save-button-container {
        margin-top: 0px;
        text-align: center;
      }

      @font-face {
        font-family: "Graphik Regular";
        font-style: normal;
        font-weight: normal;
        src: local("Graphik Regular"), url("GraphikRegular.woff") format("woff");
      }

      @font-face {
        font-family: "Graphik Bold";
        font-style: normal;
        font-weight: bold;
        src: local("Graphik Bold"), url("GraphikBold.woff") format("woff");
      }

      .segment {
        stroke: white;
        stroke-width: 2px;
      }

      .existing-segments {
        fill: #dfdfdf;
      }

      .emerging-segments {
        fill: #e9e9e9;
      }

      .distant-segments {
        fill: #f4f4f4;
      }

      .segment-band {
        stroke: white;
        stroke-width: 2px;
      }

      .opp-space-label-text {
        fill: white;
        text-anchor: middle;
        font-weight: bold;
        font-size: 11px;
        font-family: "Graphik Bold";
      }

      .label-text {
        fill: white;
        text-anchor: middle;
        font-weight: bold;
        font-size: 6px;
        font-family: "Graphik Bold";
      }

      .theme-label-text {
        fill: white;
        text-anchor: middle;
        font-weight: bold;
        font-size: 10px;
        font-family: "Graphik Bold";
      }

      .labels-theme-text {
        fill: white;
        text-anchor: middle;
        font-weight: bold;
        font-size: 10px;
        font-family: "Graphik Bold";
      }

      .funding-hover-info {
        fill: black;
        text-anchor: middle;
        font-weight: bold;
        font-size: 10px;
        font-family: "Graphik Regular";
        pointer-events: none;
      }

      .funding-hover-info.amount {
        font-size: 12px;
      }

      .funding-hover-info.title {
        font-size: 12px;
        font-family: "Graphik Bold";
      }

      .year-labels {
        fill: #8b8b8b;
        text-anchor: middle;
        font-size: 8px;
        font-family: "Graphik Bold";
      }

      .maturity-labels {
        fill: #8b8b8b;
        text-anchor: middle;
        font-size: 8px;
        font-family: "Graphik Bold";
      }

      .nodes {
        stroke: black;
        stroke-width: 1px;
      }

      .wrap-header {
        font-family: "Graphik Bold";
        font-weight: bold;
      }

      #chart-container {
        text-align: center;
      }

      .node-mouse-over-box {
        pointer-events: none;
      }

      .node-mouse-over-text {
        font-size: 10px;
        text-anchor: start;
        font-weight: bold;
        fill: #404e4d;
        font-family: "Graphik Regular";
        pointer-events: none;
        width: 100px;
      }

      .chart-title {
        font-family: "Graphik Bold";
        font-weight: bold;
        text-anchor: middle;
        font-size: 28px;
      }

      .key-label {
        font-family: "Graphik Regular";
        font-size: 10px;
        cursor: pointer;
      }

      .key-item {
        stroke: black;
        stroke-width: 1px;
        fill: white;
        cursor: pointer;
      }

      .key-item-other {
        stroke: black;
        stroke-width: 1px;
        cursor: pointer;
      }

      .key-title {
        font-weight: bold;
        font-family: "Graphik Bold";
        font-size: 12px;
      }

      .segment-band {
        cursor: pointer;
      }

      #switch-button {
        cursor: pointer;
        background-color: #8e8e8e;
        color: #faf0e6;
        padding: 10px;
        font-family: "Graphik Regular";
        font-size: 10px;
        border: none;
        cursor: pointer;
        text-anchor: middle;
        min-width: 100px;
      }

      #switch-button:hover {
        background-color: #132A54;
      }

      #switch-button-label {
        font-weight: bold;
        font-family: "Graphik Regular";
        font-size: 10px;
        text-anchor: middle;
        pointer-events: none;
      }

      /* Dropdown Button */
      .dropbtn {
        background-color: #787878;
        color: white;
        padding: 10px;
        font-family: "Graphik Regular";
        font-weight: bold;
        font-size: 10px;
        border: none;
        cursor: pointer;
        min-width: 120px;
        text-anchor: middle;
      }

      /* The container <div> - needed to position the dropdown content */
      .dropdown-industry {
        margin: auto;
        position: relative;
        display: none;
        text-anchor: middle;
      }

      /* Dropdown Content (Hidden by Default) */
      .dropdown-content {
        display: none;
        position: absolute;
        background-color: #f1f1f1;
        min-width: 120px;
        z-index: 1;
        max-height: 530px;
        overflow: auto;
        text-anchor: middle;
      }

      /* Links inside the dropdown */
      .dropdown-content a {
        color: #404e4d;
        font-size: 10px;
        font-family: "Graphik Regular";
        font-weight: bold;
        padding: 8px 0px;
        text-decoration: none;
        display: block;
        text-anchor: middle;
        text-align: center;
      }

      /* Change color of dropdown links on hover */
      .dropdown-content a:hover {
        background-color: #ddd;
      }

      /* Show the dropdown menu on hover */
      .dropdown-industry:hover .dropdown-content {
        display: block;
      }

      .dropdown-league:hover .dropdown-content {
        display: block;
      }

      /* Change the background color of the dropdown button when the dropdown content is shown */
      .dropdown-industry:hover .dropbtn {
        background-color: #132A54;
      }

      .switch-button {
        cursor: pointer;
        color: white;
        padding: 10px;
        font-family: "Graphik Regular";
        font-size: 10px;
        border: none;
        cursor: pointer;
        text-anchor: middle;
        width: 120px;
        font-weight: bold;
      }

      .switch-button-label {
        font-weight: bold;
        font-family: "Graphik Regular";
        font-size: 10px;
        text-anchor: middle;
        pointer-events: none;
      }

      #map-button,
      #save-button {
        background-color: #787878;
        display: none;
      }

      #map-button:hover,
      #save-button:hover {
        background-color: #132A54;
      }

      .switch {
        position: relative;
        display: inline-block;
        width: 60px;
        height: 34px;
      }

      /* Hide default HTML checkbox */
      .switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }

      /* The slider */
      .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #8e8e8e;
        -webkit-transition: 0.4s;
        transition: 0.4s;
      }

      .slider:before {
        position: absolute;
        content: "";
        height: 26px;
        width: 26px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        -webkit-transition: 0.4s;
        transition: 0.4s;
      }

      input:checked + .slider {
        background-color: #ea3b66;
      }

      input:focus + .slider {
        box-shadow: 0 0 1px #ea3b66;
      }

      input:checked + .slider:before {
        -webkit-transform: translateX(26px);
        -ms-transform: translateX(26px);
        transform: translateX(26px);
      }

      .toggle-button-cover {
        display: table-cell;
        position: relative;
        width: 300px;
        height: 140px;
        box-sizing: border-box;
      }

      .button-cover {
        height: 100px;
        margin: 20px;
        background-color: #fff;
        box-shadow: 0 10px 20px -8px #c5d6d6;
        border-radius: 4px;
      }

      .button-cover:before {
        counter-increment: button-counter;
        content: counter(button-counter);
        position: absolute;
        right: 0;
        bottom: 0;
        color: #d7e3e3;
        font-size: 12px;
        line-height: 1;
        padding: 5px;
      }

      .button-cover,
      .knobs,
      .layer {
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
      }

      .button {
        position: relative;
        top: 50%;
        width: 120px;
        height: 36px;
        margin: 0px auto 0 auto;
        overflow: hidden;
      }

      .button.r,
      .button.r .layer {
        border-radius: 100px;
      }

      .button.b2 {
        border-radius: 1px;
      }

      .checkbox {
        position: relative;
        width: 100%;
        height: 100%;
        padding: 0;
        margin: 0;
        opacity: 0;
        cursor: pointer;
        z-index: 3;
      }

      .knobs {
        z-index: 2;
      }

      .layer {
        width: 100%;
        background-color: #ebf7fc;
        transition: 0.8s ease all;
        z-index: 1;
      }

      #button-16 {
        display: none;
      }

      #button-16 .knobs:before {
        content: "Maturity";
        position: absolute;
        top: 4px;
        left: 4px;
        width: 60px;
        height: 10px;
        color: #fff;
        font-size: 10px;
        font-family: "Graphik Regular";
        font-weight: bold;
        text-align: center;
        line-height: 1;
        padding: 9px 4px;
        background-color: #5fbdfb;
        border-radius: 2px;
        transition: 0.8s ease all,
          left 0.8s cubic-bezier(0.18, 0.89, 0.35, 1.15);
      }

      #button-17 .knobs:before {
        content: "Startups";
        position: absolute;
        top: 4px;
        left: 4px;
        width: 60px;
        height: 10px;
        color: #fff;
        font-size: 10px;
        font-family: "Graphik Regular";
        font-weight: bold;
        text-align: center;
        line-height: 1;
        padding: 9px 4px;
        background-color: #5fbdfb;
        border-radius: 2px;
        transition: 0.8s ease all,
          left 0.8s cubic-bezier(0.18, 0.89, 0.35, 1.15);
      }

      #button-17 .checkbox:checked + .knobs:before {
        content: "Competitors";
        left: 46px;
        background-color: #ea3b66;
      }

      #button-17 .checkbox:active + .knobs:before,
      #button-16 .checkbox:active + .knobs:before {
        width: 46px;
      }

      #button-17
        .checkbox:checked:active
        + .knobs:before
        #button-16
        .checkbox:checked:active
        + .knobs:before {
        margin-left: -26px;
      }

      #button-16 .checkbox:checked + .knobs:before {
        content: "Year";
        left: 46px;
        background-color: #ea3b66;
      }

      #button-17 .checkbox:checked ~ .layer,
      #button-16 .checkbox:checked ~ .layer {
        background-color: #fcebeb;
      }

      i {
        border: solid white;
        border-width: 0 2px 2px 0;
        display: inline-block;
        padding: 2px;
      }

      .down {
        transform: rotate(45deg);
        -webkit-transform: rotate(45deg);
      }

            #map {
      }

      .bg {
        background-color: #cbcbcb;
        position: absolute;
        top: 0px;
        left: 0px;
        height: 100%;
        width: 100%;
        z-index: -1;
      }

      .country {
        stroke-width: 1.5px;
        stroke: #cbcbcb;
      }

      .sidebar {
        position: fixed;
        width: 380px;
        height: 100vh;
        background-color: #000000;
        border-left: 2px solid #454545;
        right: 0px;
        top: 0px;
      }

      .country-circle {
        fill-opacity: 0.3;
        stroke-width: 3px;
      }

      #chart-button {
        background-color: #787878;
        position: absolute;
        left: 150px;
        top: 700px;
      }

      #chart-button:hover {
        background-color: #132A54;
      }

      .map-tooltip {
        background-color: #383838;
        border: 1px solid black;
        font-weight: bold;
        font-family: "Graphik Regular";
        font-size: 14px;
        border-radius: 10px;
        min-width: 100px;
        text-align: center;
        color: white;
        position: absolute;
        padding: 10px;
      }

      .sidebar-title {
        font-weight: bold;
        font-family: "Graphik Bold";
        text-align: center;
        font-size: 36px;
        padding-top: 60px;
        padding-bottom: 20px;
        text-transform: uppercase;
        color: #787878;
      }

      #startup-list {
        padding: 40px;
        max-height: 300px;
        overflow: scroll;
      }

      .startup-table {
        min-width: 300px;
        max-height: 300px;
        overflow: scroll;
        font-family: "Graphik Regular";
        background-color: black;
        color: white;
        border: 1px solid #787878;
        padding: 10px;
      }

      .startup-table tr {
        font-size: 12px;
        height: 25px;
      }

      .startup-table td {
        min-width: 60px;
      }

      .startup-table td > a {
        color: white;
      }

      .table-header {
        font-family: "Graphik Bold";  
      }

      .left-sidebar {
          align-items: center;
          justify-content: center;
              overflow: hidden;
          position: fixed;
            width: 146px;
            height: 100vh;
            left: 0px;
            top: 0px;
            background-color: #000000;
            border-right: 2px solid #454545;
            font-family: "Graphik Bold";  
            vertical-align: middle;
            text-align: center;
            text-anchor: middle;
      }

      .left-sidebar-header {
            width: 100%;
    height: 96px;
    display: flex;
    position: relative;
    align-items: center;
    justify-content: center;
      }

      .compass-title {
        font-size: 12px;
        width: 96px;
        text-align: center;
        color: #787878;
        margin: auto;
      }

      .left-sidebar-header img {
        width: 40px;
        height: 40px;
        object-fit: contain;
      }

      .left-sidebar-buttons {
        top: 25%;
        position: relative;
      }

      .left-sidebar-btn {
        font-size: 18px;
        width: 96px;
        cursor: pointer;
        height: 96px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column-reverse;
        color: #787878;
        margin: auto;
      }

      .left-sidebar-btn > i {
        border: 0px;
      }

      .left-sidebar-btn-label {
        margin-top: 5px;
        font-size: 10px;
      }

      .left-sidebar-btn.active {
        color: #DDDDDD;
    }

    .popup-bg {
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      z-index: 9999;
      position: fixed;
      top: 0px;
      left: 0px;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: rgba(0,0,0,0.4);
    }

    .popup-container {
      opacity: 1;
      bottom: 300%;
      border-top-left-radius: 30px;
    border-top-right-radius: 30px;
    width: 92vw;
    height: 92%;
    position: absolute;
    z-index: 33333;
    background: white;
    padding-top: 30px;
    align-items: center;
    justify-content: center;
    overflow: scroll;
    }

    .popup-container.added {
      bottom: 0px;
  }

  .analysis-btn {
    position: relative;
    top: 0vh;
    margin: 0 auto;
    font-size: 24px;
    width: 96px;
    cursor: pointer;
    height: 96px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column-reverse;
    color: #36363c
  }

  .analysis-btn:hover {
    font-size: 30px;
  }

  .popup-analysis-label {
    font-size: 14px;
    font-family: "Graphik Bold";
    margin-bottom: 5px;
  }

  .popup-close {
    position: relative;
    top: -20px;
    left: 87.4vw;
    font-size: 22px;
    display: inline;
    cursor: pointer;
    align-items: center;
    justify-content: center;
    color: #36363c
  }

  .popup-tag {
    position: relative;
    top: 5px;
    font-family: "Graphik Bold";
    font-size: 12px;
    margin-left: 35px;
    color: #36363c;
    text-transform: capitalize;
  }

  .popup-tag-item {
    display: inline;
    background-color: #E6E6E6;
    border-radius: 2px;
    padding: 6px;
    
  }

  .popup-tag-item-arr {
    display: inline;
    padding-left: 10px;
    padding-right: 10px;
    
  }

  .column {
    float: left;
    padding: 0px;
    margin: 5px;
    height: 76vh;
    margin-top: 0px;
    margin-bottom: 0px;
  }

  .left {
    width: 35%;
    margin-left: 35px;
  }

  .right {
    width: 58%;
    margin-right: 35px;
  }

  .popup-section-a:after {
    content: "";
    display: table;
    clear: both;
  }

  .svg-container {
    margin: auto;
    margin-bottom: 30px;
  }

  .opportunity-space-title {
    font-family: "Graphik Bold";
    text-transform: capitalize;
    background-color: #E6E6E6;
    border-radius: 2px;
    padding: 6px;
    font-size: 12px;
    display: inline-block;
    color: #36363c
  }

  .opportunity-space-description {
    font-size: 12px;
    color: #36363c;
    margin: 10px;
    font-family: "Graphik Regular";
    margin-bottom: 15px;
    margin-right: 15px;
    
  }

  .opportunity-space-summary-row {
    height: 26px;
    width: 100%;
    border: 1px solid white;;
  }

  .column-value {
    font-family: "Graphik Regular";
    font-size: 12px;
  }

  .column-icon {
    display: inline;
    margin: auto;
    min-width: 26px;
  }

  .column-icon > i {
    border: 0px;
    color: #36363c;
    width: 26px;
    margin: auto;
    text-align: center;
  }

  .column-desc {
    font-size: 12px;
    color: #36363c;
    font-family: "Graphik Regular";
    display: inline;
  }

  .column-value {
    display: inline;
  }

  .right-title {
    font-size: 30px;
    color: #36363c;
    font-family: "Graphik Bold";
    margin-bottom: 15px;
  }

  .hero-startup {
    margin-bottom: 15px;
    color: #36363c;
  }

  .hero-startup-container {
    padding: 10px;
    height: 150px;
  }

  .hero-startup-number {
    float: left;
    color: #36363c;
    font-size: 20px;
    font-family: "Graphik Bold";
    border-radius: 30px;
    background-color: #E6E6E6;
    text-align: center;
    width: 1.6em; 
    margin-right: 15px;
    line-height: 1.6em;
  }

  .fl {
      float: left;
  }

  .hero-startup-logo-container {
    display:table-cell;
    padding: 5px;
        padding-top: 0px;
        padding-bottom: 0px;
        max-width: 140px;
    text-align: center; 
    vertical-align: middle;
  }

  .hero-startup-logo {
      margin: auto;
    width: 110px;
  }

  .hero-startup-desc {
        float: left;
        width: 60%;
    font-family: "Graphik Regular";
    font-size: 12px;
    padding: 5px;
  }

  .hero-startup-stats {
        float: left;
        width: 25%;
    font-family: "Graphik Regular";
    font-size: 12px;
    padding: 5px;
    margin-bottom: 20px;
  }

  .hero-startup-desc-overview {
    margin-bottom: 5px;
  }

  .hero-startup-desc-problem {
    margin-bottom: 5px;
  }

  .hero-startup-stats-website {
    margin-bottom: 5px;
  }

  .hero-startup-stats-location {
    margin-bottom: 5px;
  }

  .hero-startup-stats-round {
    margin-bottom: 5px;
  }

  .hero-startup-stats-amount {
    margin-bottom: 5px;
  }

  .popup-section-b {
    padding: 10px;
    margin: 20px;
    margin-bottom: 10px;
    height: 70vh;
  }

  .bar-chart-title {
    font-size: 30px;
    color: #36363c;
    font-family: "Graphik Bold";
    margin-bottom: 20px;
  }

  .dropbtn-b {
    background-color: #787878;
    color: white;
    padding: 10px;
    font-family: "Graphik Regular";
    font-weight: bold;
    font-size: 10px;
    border: none;
    cursor: pointer;
    min-width: 140px;
    text-anchor: middle;
  }

  /* The container <div> - needed to position the dropdown content */
  .dropdown-bar-chart {
    position: relative;
    display: inline-block;
    text-anchor: middle;
    margin-bottom: 10px;
  }

  /* Dropdown Content (Hidden by Default) */
  .dropdown-bar-content {
    display: none;
    position: absolute;
    background-color: #f1f1f1;
    min-width: 140px;
    z-index: 1;
    max-height: 530px;
    overflow: auto;
    text-anchor: middle;
  }

  /* Links inside the dropdown */
  .dropdown-bar-content a {
    color: #404e4d;
    font-size: 10px;
    font-family: "Graphik Regular";
    font-weight: bold;
    padding: 8px 0px;
    text-decoration: none;
    display: block;
    text-anchor: middle;
    text-align: center;
  }

  /* Change color of dropdown links on hover */
  .dropdown-bar-content a:hover {
    background-color: #ddd;
  }

  /* Show the dropdown menu on hover */
  .dropdown-bar-chart:hover .dropdown-bar-content {
    display: block;
  }

  /* Change the background color of the dropdown button when the dropdown content is shown */
  .dropdown-bar-chart:hover .dropbtn-b {
    background-color: #132A54;
  }

  .svg-bar-container {
      margin: auto;
    width: 900px;
    height: 460px;
  }

  .bar-axis-label {
    text-anchor: middle;
    text-align: center;
    font-size: 12px;
    font-family: "Graphik Regular";
  }

  .map-container {
    grid-column: 2 / span 1;
    grid-row: 1 / span 2;
  }

  .tick > line {
    stroke: lightgrey;
    stroke-opacity: 1;
    shape-rendering: crispEdges;
  }

  .node-tooltip {
    position: fixed;
    z-index: 99999;
    left: 0;
    top: 0;
    padding: 0.5em 1em;
    background: rgba(255, 255, 255, 1.0);
    pointer-events: none;
    opacity: 0;
    text-align: left;
    text-anchor: start;
    max-width: 400px;
    font-size: 10px;
    box-shadow: 0 4px 12px 0px rgba(0,0,0,.25);
    
  }

  .node-tooltip-title {
    font-family: "Graphik Bold";
    padding-top: 3px;
    padding-bottom: 5px;
  }

  .node-tooltip-funding {
    font-family: "Graphik Regular";
    padding-bottom: 3px;
  }

  .node-tooltip-description {
    font-family: "Graphik Regular";
    padding-bottom: 3px;
  }

  #opp-space-tooltip-container {
    grid-column: 4 / span 1;
    grid-row: 2 / span 2;
    display: none;
  }

  .opp-space-tooltip {
    padding: 0.5em 1em;
    background: rgba(255, 255, 255, 1.0);
    text-align: left;
    text-anchor: start;
    max-width: 400px;
    font-size: 10px;
    box-shadow: 0 4px 12px 0px rgba(0,0,0,.25);
  }

  .opp-space-tooltip-title {
    font-family: "Graphik Bold";
    padding-top: 3px;
    padding-bottom: 5px;
  }

  .opp-space-tooltip-sub-heading {
    font-family: "Graphik Regular";
    padding-bottom: 3px;
  }

  .opp-space-tooltip-item {
    font-family: "Graphik Regular";
    padding-bottom: 5px;
  }



  .bold {
    font-family: "Graphik Bold";
    padding-top: 5px;
  }

    </style>

  </head>

  <body>
      <div id="key-container"></div>
    <div class="node-tooltip">
      <div class="node-tooltip-title"></div>
      <div class="node-tooltip-description"></div>
    </div>

  
    <div class="left-sidebar">
      <div class="left-sidebar-header">
        <img src="assets/logo-.png">
      </div>

      <div class="left-sidebar-buttons">
        <div id="radar-toggle-btn" class="left-sidebar-btn">
        <div class="left-sidebar-btn-label">Radar</div>
        <i class="fas fa-bullseye fa-lg"></i>
        
        </div>
      </div>
    </div>

    <div id="hover-info-container"></div>
  <div id="opp-space-tooltip-container">
      <div class="opp-space-tooltip">
      <div class="opp-space-tooltip-title"></div>
      <div id="ostt-1" class="opp-space-tooltip-item"></div>
      <div id="ostt-2" class="opp-space-tooltip-sub-heading">Total Funding:</div>
      <div id="ostt-3" class="opp-space-tooltip-item"></div>
      <div id="ostt-4" class="opp-space-tooltip-sub-heading">Total Number of Startups:</div>
      <div id="ostt-5" class="opp-space-tooltip-item"></div>
      <div id="ostt-6" class="opp-space-tooltip-sub-heading">Average Funding:</div>
      <div id="ostt-7" class="opp-space-tooltip-item"></div>
      <div id="ostt-8" class="opp-space-tooltip-item bold"></div>
      <div id="ostt-9" class="opp-space-tooltip-item"></div>
    </div>
  </div>

</div>
    <div id="chart-container"></div>
    <div id="control-container">
      <div>
          <div>

    
            <div>



          <div id="save-button-container">
            <button class="switch-button" id="save-button">Save Image</button>
          </div>
        </div>
        
      </div>
      
    </div>

    <div id="tmp-container"></div>



    <script>
        var width = 800,
          height = 860,
          innerRadius = 50,
          outerRadius = 300,
          keySize = 10,
          keySpacing = 10,
          radial = "maturity",
          animationDuration = 2000,
          keyWidth = 160,
          keyHeight = 260,
          filter = 0,
          filterKey = "",
          industryFilter = "All Startups",
          logoPath = "",
          titleLogoWidth = 80,
          titleLogoHeight = 50,
          hoverOn = 0;
        hoverSegment = "",
        leftWidth = 1100,
          leftHeight = 650,
          bar_width = 900,
          bar_height = 460,
          popupMode = {"page": "none", "type": "none"},
          indexTracker = {},
          indexTrackerYear = {};

    var categoryFontObject = [
      { name: 'themeFont',
        dy_upper: "-1.15em",
        dy_lower: "1.85em"
      },
      {
        fontSize: "30px",
        letterSpacing: "5px",
        letterSpaceVal: 5,
        dy_upper: "-1.05em",
        dy_lower: "1.8em"
      },
      {
        fontSize: "24px",
        letterSpacing: "4px",
        letterSpaceVal: 4,
        dy_upper: "-1.25em",
        dy_lower: "2em"
      }
    ];

            // loader settings
          var opts = {
            lines: 9, // The number of lines to draw
            length: 7, // The length of each line
            width: 8, // The line thickness
            radius: 24, // The radius of the inner circle
            top: "57%",
            left: "38.5%",
            color: "#132A54", // #rgb or #rrggbb or array of colors
            speed: 1.9, // Rounds per second
            trail: 40, // Afterglow percentage
            className: "spinner" // The CSS class to assign to the spinner
          };

          var target = document.getElementById("chart-container");

          var spinner = new Spinner(opts).spin(target);

          d3.select("#radar-toggle-btn").attr("class", "left-sidebar-btn active")
  
        var svg = d3
          .select("#chart-container")
          .append("svg")
          .attr("width", width)
          .attr("height", height);
  
        var chartSVG = svg
          .append("g")
          .attr(
            "transform",
            "translate(" + width / 2 + "," + (height / 2 + 20) + ")"
          );
  
        var keySVG = d3
          .select("#key-container")
          .append("svg")
          .attr("width", keyWidth)
          .attr("height", keyHeight)
          .append("g")
          .attr(
            "transform",
            "translate(" + keyWidth / 2 + "," + keyHeight / 2 + ")"
          );
  
        var hoverSVG = d3
          .select("#hover-info-container")
          .append("svg")
          .attr("width", 200)
          .attr("height", 300)
          .append("g")
          .attr("transform", "translate(" + 200 / 2 + "," + 300 / 2 + ")");
  
        var chartTitle = chartSVG
          .append("text")
          .attr("class", "chart-title")
          .text("CoronavirusRadar")
          .attr("y", (-height * 4.55) / 10)
          .style("display", "none")
  

  

  
  
        d3.csv(
          "https://docs.google.com/spreadsheets/d/e/2PACX-1vR-BAWGg0c1wQ5NVrvOTEBhRqGnTJUZn8jAofUum8kVS2E-ji8rjncAZAUQJvRb5dDUbVRM1qXbgeAV/pub?gid=613487733&single=true&output=csv "
        ).then(function(data) {

          data = data.filter(function(d) {
            return d["To Include"] === "TRUE"
          })

              var themeSorted = d3
              .nest()
              .key(function(d) {
                return d["Theme"];
              })
              .sortKeys(d3.ascending)
              .entries(data);


              console.log(data)

              spinner.stop();
              d3.select("#button-16").style("display", "block")
              d3.select(".dropdown-industry").style("display", "inline-block")
              d3.select("#save-button").style("display", "block")
              d3.select(".chart-title").style("display", "")

              function modeArray(array) {
                if (array.length == 0) return null;
                var modeMap = {},
                  maxCount = 1,
                  modes = [];
              
                for (var i = 0; i < array.length; i++) {
                  var el = array[i];
              
                  if (modeMap[el] == null) modeMap[el] = 1;
                  else modeMap[el]++;
              
                  if (modeMap[el] > maxCount) {
                    modes = [el];
                    maxCount = modeMap[el];
                  } else if (modeMap[el] == maxCount) {
                    modes.push(el);
                    maxCount = modeMap[el];
                  }
                }
                return modes;
              }
  

  

  

  
            var colors = ["#D75059", "#82D4BB", "#388659"];
  


  
  
            var maturity_list = [
              { name: "", inner: 50, outer: 300 }
            ];
  
            var backgroundArc = d3
              .arc()
              .innerRadius(maturity_list[0].inner)
              .outerRadius(maturity_list[0].outer);
  
            var existingArc = d3
              .arc()
              .innerRadius(maturity_list[0].inner)
              .outerRadius(maturity_list[0].outer);

  
            var themeArc = d3
              .arc()
              .innerRadius(330)
              .outerRadius(360);
  
            var chartPie = d3
              .pie()
              .value(function(d) {
                return 1
              })
              .sort(function(a, b) {
                return d3.ascending(a.key, b.key)
              });
  
            var chartPieData = chartPie(d3.entries(themeSorted));


            themeFontData = categoryFontObject[0];
  
  
            var backgroundSegments = chartSVG
              .selectAll("background-segments")
              .data(chartPieData)
              .enter()
              .append("path")
              .attr("id", function(d) {
                return (
                  "background-segment-" +
                  d.data.value.key.replace(/ /g, "-").replace(/&/g, "and")
                );
              })
              .style("opacity", 0)
              .attr("d", backgroundArc);
  
            maturity_list.forEach(function(v) {
              var tmpArc = d3
                .arc()
                .innerRadius(v.inner)
                .outerRadius(v.outer);
  
              var tmpSegment = chartSVG
                .selectAll("existing-segments")
                .data(chartPieData)
                .enter()
                .append("path")
                .attr("class", "segment segments")
                .attr("fill", "#F4F4F4")
                .attr("id", function(d) {
                  return (
                    v.name.toLowerCase() +
                    "-" +
                    d.data.value.key.replace(/ /g, "-").replace(/&/g, "and") +
                    "-segment"
                  );
                })
                .attr("d", tmpArc)
                .attr("opacity", 1)
            });

  
            var numSegments = themeSorted.length;
  
            var segmentArc = d3
              .arc()
              .innerRadius(innerRadius)
              .outerRadius(outerRadius);
  
            var segmentLabelArc = d3
              .arc()
              .innerRadius(outerRadius)
              .outerRadius(outerRadius * 1.05);
  
            var segmentLabelBandArc = d3
              .arc()
              .innerRadius(outerRadius)
              .outerRadius(outerRadius * 1.095);

            oppSpaceFontData = categoryFontObject[1]

            var labelWidth = (2 * outerRadius * 1.095) / chartPieData.length;

              labelFontData = {
                limit: labelWidth * 0.6
              };
  
            var segmentsLabelBand = chartSVG
              .selectAll("path.segment-band")
              .data(chartPieData)
              .enter()
              .append("path")
              .classed("segment-band", true)
              .attr("d", segmentLabelBandArc)
              .attr("id", function(d) {
                return (
                  d.data.value.key.toLowerCase().replace(/ /g, "-") + "-band"
                );
              })
              .attr("fill", "#82ADBD")
              .each(function(d, i) {
                var firstArcSection = /(^.+?)L/;
                var newArc = firstArcSection.exec(d3.select(this).attr("d"))[1];
                d.newArc = newArc.replace(/,/g, " ");
                d.percentage =
                  ((d.endAngle - d.startAngle) / 2 + d.startAngle) / 0.0628319;
                if (d.percentage >= 100) {
                  d.percentage -= 100;
                }
                if (d.percentage >= 25 && d.percentage <= 75) {
                  var startLoc = /M(.*?)A/;
                  var middleLoc = /A(.*?)0 0 1/;
                  var endLoc = /0 0 1 (.*?)$/;
                  d.newStart = endLoc.exec(d.newArc)[1];
                  d.newEnd = startLoc.exec(d.newArc)[1];
                  d.middleSec = middleLoc.exec(d.newArc)[1];
                  d.newArc =
                    "M" + d.newStart + "A" + d.middleSec + "0 0 0 " + d.newEnd;
                }
                d.hiddenArc = chartSVG
                  .append("path")
                  .attr("class", "hiddenDonutArcs")
                  .attr("id", function() {
                    return (
                      "hidden-opp-space-band-" + d.data.value.key.toLowerCase().replace(/ /g,"-")
                    );
                  })
                  .attr("d", d.newArc)
                  .style("fill", "none");
              })

              var oppSpaceLabels = chartSVG
                .selectAll(".opp-space-label-text")
                .data(chartPieData)
                .enter()
                .append("g")
                .selectAll(".test-class")
                .data(function(d) {
                  var limit = labelFontData.limit;

                  return textWrap(
                    d.data.value.key.toUpperCase(),
                    d.percentage,
                    limit
                  );
                })
                .enter()
                .append("text")
                .attr("class", "label opp-space-label-text")
                .attr("dy", function(d, i) {
                  if (d.percentage >= 25 && d.percentage <= 75) {
                    if (d.lineLength === 1) {
                      return "-1em";
                    } else {
                      if (i === 0) {
                        return "-2.6em";
                      } else {
                        return "-1.3em";
                      }
                    }
                  } else {
                    if (d.lineLength === 1) {
                      return "1.7em";
                    } else {
                      if (i === 0) {
                        return "2.1em";
                      } else {
                        return "3.3em";
                      }
                    }
                  }
                })
                .append("textPath")
                .attr("xlink:href", function(d, i) {
                  return (
                    "#" +
                    "hidden-opp-space-band-" +
                    d.text_data.toLowerCase().replace(/ /g,"-")
                  );
                })
                .attr("startOffset", "50%")
                .text(function(d) {
                  return d.data
                });  

            var nodeData = d3
            .nest()
            .key(function(d) {
              return d["Theme"];
            })
            .entries(data);
          
            nodeData.forEach(function(v) {
                indexTracker[v.key] = {'slot': 1}
            })

            var nodeList = [];
            data.forEach(function(d) {
                for (i = 0; i < chartPieData.length; i++) {
                  if (
                    d["Theme"] === chartPieData[i].data.value.key
                  ) {
                    var tmp_startAngleMin = chartPieData[i].startAngle + 0.25
                    var tmp_endAngleMax = chartPieData[i].endAngle - 0.25
                    tmp_innerRadiusMin = maturity_list[0].inner + 30
                    tmp_outerRadiusMax = maturity_list[0].outer - 30
                    break;
                  }
                }

                for (i = 0; i < nodeData.length; i++) {
                  if (nodeData[i].key === d["Theme"]) {

        

                        //console.log(nodeData[i].values[j])

                        var congestion = calcCongestion(
                          tmp_startAngleMin,
                          tmp_endAngleMax,
                          tmp_innerRadiusMin,
                          tmp_outerRadiusMax,
                          radiusSize,
                          nodeData[i].values.length
                        )

                        if (congestion > 10) {
                           d.results = assignRandom(
                            tmp_startAngleMin,
                            tmp_endAngleMax,
                            tmp_innerRadiusMin,
                            tmp_outerRadiusMax,
                            congestion,
                            nodeList
                          );  
                          
                        } else {
                          d.results = assignNonRandom(
                            d,
                            tmp_startAngleMin,
                            tmp_endAngleMax,
                            tmp_innerRadiusMin,
                            tmp_outerRadiusMax,
                            nodeData[i].values[j]
                          )
                          indexTracker[d["Theme"]]["slot"] += 1
                        }


                        /* var results = assignRandom(
                          tmp_startAngleMin,
                          tmp_endAngleMax,
                          tmp_innerRadiusMin,
                          tmp_outerRadiusMax,
                          nodeList
                        ); */
                      
                    
                  }
                }

                if (d.results) {
                d.x = d.results[0];
                d.y = d.results[1];
                } else {
                d.x = 0//results[0];
                d.y = 0//results[1];
                }
                d.opacity = 1;
              });


            var radiusSize = 2;

            var nodes = chartSVG
              .selectAll("nodes")
              .data(data)
              .enter()
              .append("a")
              .attr("xlink:href", function(d) {
                return formatURL(d.Website)
              })
              .attr("target", "_blank")
              .append("image")
              /*.each(function(d) {
                d.hide = false;
              })*/
              .attr("class", "nodes")
              .attr("x", function(d) {
                return d.x;
              })
              .attr("y", function(d) {
                return d.y;
              })
              .attr("xlink:href", function(d) {
                return (d["Logo (source)"])
              })
              .attr("width", function(d) {
                return 40
              })
              .on("mouseover", function(d) {
                //nodeMouseOver(d);
                showNodeTooltip(d)
              })
              .on("mouseout", hideNodeTooltip);
  
  
          
            function textWrap(text_data, percentage, limit = 6) {
              result = [];
              if (text_data.length > limit) {
                if (text_data.length >= (limit -1)* 2) {
                    a = text_data.substr(0, limit).lastIndexOf(" ")
                    y = text_data.substr(0, a)
                    a_rem = text_data.substr(a + 1)
                    b = a_rem.substr(0, limit).lastIndexOf(" ")
                    z = a_rem.substr(0, b)
                    result.push({
                      data: y,
                      text_data: text_data,
                      percentage: percentage,
                      lineLength: 2
                    });
                    result.push({
                      data: z + "...",
                      text_data: text_data,
                      percentage: percentage,
                      lineLength: 2
                    });
                } else {
                var tmp_limit = text_data.length / 2 - 4;
                var lines = dummy(text_data, tmp_limit);

                lines.forEach(function(d) {
                  if (d.length > 1) {
                    d = d.join(" ");
                  }
                  if (d !== "") {
                    result.push({
                      data: d,
                      text_data: text_data,
                      percentage: percentage,
                      lineLength: lines.length
                    });
                  }
                });
                }
              } else {
                result.push({
                  data: text_data,
                  text_data: text_data,
                  percentage: percentage,
                  lineLength: 1
                });
              }
              var maxLength = d3.max(result, function(d) {
                return d.data.length;
              });
              result.forEach(function(d) {
                d.MaxLength = maxLength;
              });
              return result;
            }

                  function dummy(text, limit) {
        words = text.split(" ");
        words_rev = temporarySwap([...words]);
        lines = [];
        lines_rev = [];

        current_seq_len = 0;
        current_seq = [];
        words.forEach(function(d) {
          current_seq_len += d.length;
          current_seq.push(d.replace(/�۪/g, "'"));
          if (current_seq_len > limit) {
            lines.push(current_seq);
            current_seq_len = 0;
            current_seq = [];
          }
        });
        if (current_seq.length > 0) {
          lines.push(current_seq);
          current_seq_len = 0;
          current_seq = [];
        }

        current_seq_len = 0;
        current_seq = [];
        words_rev.forEach(function(d) {
          current_seq_len += d.length;
          current_seq.push(d.replace(/�۪/g, "'"));
          if (current_seq_len > limit) {
            lines_rev.push(temporarySwap(current_seq));
            current_seq_len = 0;
            current_seq = [];
          }
        });
        if (current_seq.length > 0) {
          lines_rev.push(temporarySwap(current_seq));
          current_seq_len = 0;
          current_seq = [];
        }
        if (lines.length === 3) {
          return temporarySwap(lines_rev);
        }
        if (lines_rev.length > lines.length && lines_rev.length !== 3) {
          return temporarySwap(lines_rev);
        }
        return lines;
      }

            function temporarySwap(array) {
        var left = null;
        var right = null;
        var length = array.length;
        for (left = 0; left < length / 2; left += 1) {
          right = length - 1 - left;
          var temporary = array[left];
          array[left] = array[right];
          array[right] = temporary;
        }
        return array;
      }


  
            
  
            function dateForMode(data) {
              if (
                CompetitorMode === 0 ||
                data["Competitor Categor  y"] !== "Activity"
              ) {
                return data.Founded;
              } else {
                return data["Activity/Acquisition Time"];
              }
            }
  
            function text_wrap(entry) {
              limit = 20;
              entryList = entry.split(/\s+/);
              lines = [];
              current_seq_len = 0;
              current_seq = [];
              for (i = 0; i < entryList.length; i++) {
                current_seq_len += entryList[i].length;
                current_seq.push(entryList[i].replace(/�۪/g, "'"));
                if (current_seq_len > limit) {
                  lines.push(current_seq);
                  current_seq_len = 0;
                  current_seq = [];
                }
              }
              lines.push(current_seq);
              results = "";
              x = 0;
              for (i = 0; i < lines.length; i++) {
                tmp = "";
                for (j = 0; j < lines[i].length; j++) {
                  if (j !== lines[i].length - 1) {
                    tmp += lines[i][j] + " ";
                  } else {
                    tmp += lines[i][j];
                  }
                }
                results +=
                  "<tspan x=" +
                  x +
                  " dy='1.1em' class='funding-hover-info'>" +
                  tmp +
                  "</tspan>";
              }
              return results;
            }
  
            function hoverInfoFunction(segment_data, clicked = "") {
              var segmentDesc;
  
              desc.forEach(function(v) {
                if (
                  segment_data.data.value.key ===
                  v["Opportunity Space"].toLowerCase().replace(/\//g, "_")
                ) {
                  segmentDesc = v.Description;
                }
              });
  
              descFormatted = text_wrap(segmentDesc);
              hoverSVG
                .append("rect")
                .attr("width", 240)
                .attr("height", 300)
                .attr("fill", "white")
                .attr("x", -120)
                .attr("y", -300 / 2)
                .attr("id", "hover-svg-background" + clicked)
                .attr("class", "hover-svg-background" + clicked);
              hoverSVG
                .append("text")
                .attr("id", "label-mouse-over-text" + clicked)
                .attr("class", "hover-svg-background" + clicked)
                .attr("y", -120)
                .html(function() {
                  var x = 0;
                  var numberOfStartups = 0;
                  var segmentFunding = 0;
                  for (i = 0; i < count_by_focus_area.length; i++) {
                    if (
                      count_by_focus_area[i].key === segment_data.data.value.key
                    ) {
                      numberOfStartups = count_by_focus_area[i].values.length;
                      theme = count_by_focus_area[i].values[0]["Themes"];
                      themeDesc =
                        count_by_focus_area[i].values[0]["Theme Definition"];
                      segmentFunding = d3.sum(
                        count_by_focus_area[i].values,
                        function(d) {
                          return d["Total funding (US$)"];
                        }
                      );
                    }
                  }
                  if (numberOfStartups === 0) {
                    var avgFunding = 0;
                  } else {
                    var avgFunding = segmentFunding / numberOfStartups;
                  }
                  themeDesc = text_wrap(themeDesc);
  
                  line0 =
                    "<tspan x=" +
                    x +
                    " dy='1.1em' class='funding-hover-info title'>" +
                    capitalize_sentence(segment_data.data.value.key) +
                    "</tspan>";
                  lineDesc =
                    "<tspan x=" +
                    x +
                    " dy='1.7em' class='funding-hover-info'>" +
                    segmentDesc +
                    "</tspan>";
                  line1 =
                    "<tspan x=" +
                    x +
                    " dy='1.7em' class='funding-hover-info'>Total Funding:</tspan>";
                  line2 =
                    "<tspan x=" +
                    x +
                    " dy='1.1em' class='funding-hover-info amount'>$" +
                    formatFunding(segmentFunding) +
                    "</tspan>";
                  line3 =
                    "<tspan x=" +
                    x +
                    " dy='1.7em' class='funding-hover-info'>Total Number of Startups:</tspan>";
                  line4 =
                    "<tspan x=" +
                    x +
                    " dy='1.1em' class='funding-hover-info amount'>" +
                    numberOfStartups +
                    "</tspan>";
                  line5 =
                    "<tspan x=" +
                    x +
                    " dy='1.7em' class='funding-hover-info'>Average Funding:</tspan>";
                  line6 =
                    "<tspan x=" +
                    x +
                    " dy='1.1em' class='funding-hover-info amount'>$" +
                    formatFunding(avgFunding) +
                    "</tspan>";
                  line7 =
                    "<tspan x=" +
                    x +
                    " dy='1.7em' class='funding-hover-info'>Theme:</tspan>";
                  line8 =
                    "<tspan x=" +
                    x +
                    " dy='1.1em' class='funding-hover-info'>" +
                    theme +
                    "</tspan>";
                  line9 =
                    "<tspan x=" +
                    x +
                    " dy='1.7em' class='funding-hover-info'>Theme Definition:</tspan>";
                  line10 =
                    "<tspan x=" +
                    x +
                    " dy='1.7em' class='funding-hover-info'>" +
                    themeDesc +
                    "</tspan>";
                  return (
                    line0 +
                    descFormatted +
                    line1 +
                    line2 +
                    line3 +
                    line4 +
                    line5 +
                    line6 +
                    line7 +
                    line8 +
                    line9 +
                    line10
                  );
                });
  
              segmentsLabelBand.attr("opacity", function(d) {
                if (d.data.key === segment_data.data.key) {
                  return 1;
                } else {
                  return 0.3;
                }
              });
            }
  
            function labelMouseOver(segment_data) {
              var count_by_focus_area = d3
                .nest()
                .key(function(d) {
                  return d["Opportunity space"];
                })
                .sortKeys(focusAreaSort)
                .entries(
                  data.filter(function(d) {
                    if (industryFilter !== "All Startups") {
                      return d.Industry === industryFilter;
                    } else {
                      return d;
                    }
                  })
                );
  
              nodes.attr("opacity", function(d) {
                if (d["Opportunity space"] === segment_data.data.value.key) {
                  return 1;
                } else {
                  return 0.3;
                }
              });
  
              nodes_acquired.attr("opacity", function(d) {
                if (d["Opportunity space"] === segment_data.data.value.key) {
                  return 1;
                } else {
                  return 0.3;
                }
              });
            }
  
            function labelMouseOut() {
              //d3.select("#label-mouse-over-text").remove();
              //d3.select("#hover-svg-background").remove();
               d3.select("#opp-space-tooltip-container").style("display", "none")
              segmentsLabelBand.attr("opacity", function(d) {
                return d.opacity;
              });
              nodes.attr("opacity", function(d) {
                return d.opacity;
              });
              nodes_acquired.attr("opacity", function(d) {
                return d.opacity;
              });
            }
  
            function keyMouseOver(data, type) {
              if (type === "acquired") {
                nodes_acquired.attr("opacity", 1);
                nodes.attr("opacity", 0.3);
                nodes_activity.attr("opacity", 0.3);
              }
              /* if (type === "size") {
                  nodes.attr("opacity", function(d) {
                    if (nodeSizeScaleFunction(d["Total funding (US$)"]) === data) {
                      return 1;
                    } else {
                      return 0.3;
                    }
                  });
                  nodes_acquired.attr("opacity", 0.3);
                } */
              if (type === "color") {
                nodes.attr("opacity", function(d) {
                  if (fundingCategoryScale(d["Funding Stage"]) === data) {
                    return 1;
                  } else {
                    return 0.3;
                  }
                });
                nodes_acquired.attr("opacity", 0.3);
                nodes_activity.attr("opacity", 0.3);
              }
  
              if (type === "activity") {
                nodes.attr("opacity", function(d) {
                  if (d["Activity/Acquisition Time"] != "" && d.hide === false) {
                    return 1;
                  } else {
                    return 0.3;
                  }
                });
  
                nodes_activity.attr("opacity", function(d) {
                  if (d["Activity/Acquisition Time"] != "") {
                    return 1;
                  } else {
                    return 0.3;
                  }
                });
  
                nodes_acquired.attr("opacity", function(d) {
                  if (d["Activity/Acquisition Time"] != "" && d.hide === false) {
                    return 1;
                  } else {
                    return 0.3;
                  }
                });
              }
            }
  
            function keyMouseOut() {
              nodes.attr("opacity", function(d) {
                return d.opacity;
              });
              nodes_acquired.attr("opacity", function(d) {
                return d.opacity;
              });
            }

            function showOppSpaceTooltip(segment_data, clicked = "") {              
              desc.forEach(function(v) {
                if (
                  segment_data.data.value.key ===
                  v["Opportunity Space"].toLowerCase().replace(/\//g, "_")
                ) {
                  segmentDesc = v.Description;
                }
              });
              var numberOfStartups = 0;
              var segmentFunding = 0;
              for (i = 0; i < count_by_focus_area.length; i++) {
                if (
                  count_by_focus_area[i].key === segment_data.data.value.key
                ) {
                  numberOfStartups = count_by_focus_area[i].values.length;
                  theme = count_by_focus_area[i].values[0]["Themes"];
                  themeDesc =
                    count_by_focus_area[i].values[0]["Theme Definition"];
                  segmentFunding = d3.sum(
                    count_by_focus_area[i].values,
                    function(d) {
                      return d["Total funding (US$)"];
                    }
                  );
                }
              }
              if (numberOfStartups === 0) {
                  var avgFunding = 0;
                } else {
                  var avgFunding = segmentFunding / numberOfStartups;
                }
              d3.select("#opp-space-tooltip-container").style("display", "block")
              d3.select(".opp-space-tooltip-title").text((segment_data.data.value.key).toUpperCase().replace(/_/g, "/"))
              d3.select("#ostt-1").text(segmentDesc)
              d3.select("#ostt-3").text(formatFunding(segmentFunding))
              d3.select("#ostt-5").text(numberOfStartups)
              d3.select("#ostt-7").text(formatFunding(avgFunding))
              d3.select("#ostt-8").text(theme.toUpperCase())
              d3.select("#ostt-9").text(themeDesc)
            }

            function formatURL(url) {
              if (url.slice(0,3) === "www") {
                return "http://" + url
              } else {
                return url
              }
            }

            function showNodeTooltip(d) {
              d3.select(".node-tooltip-title").text(d.Company);
              d3.select(".node-tooltip-description").text(d["One Liner"].replace(/�۪/g, "'"));

              d3.select(".node-tooltip")
              .style("opacity", 1);

              const { width, height } =  d3.select(".node-tooltip").node().getBoundingClientRect();

              let padding = 10;
              let x = d3.event.clientX;
              if (x + padding + width > window.innerWidth) {
                x = x - padding - width;
              } else {
                x = x + padding;
              }
              let y = d3.event.clientY;
              if (y + padding + height > window.innerHeight) {
                y = y - padding - height;
              } else {
                y = y + padding;
              }

              nodes.attr("opacity", function(v) {
                if (v.Company === d.Company) {
                  return 1;
                } else {
                  return 0.3;
                }
              });

              d3.select(".node-tooltip").style("transform", `translate(${x}px,${y}px)`);
            }

            function hideNodeTooltip() {
              d3.select(".node-tooltip")
              .style("opacity", 0);
              nodes.attr("opacity", function(d) {
                return d.opacity;
              });
            }
    
            function nodeMouseOut() {
              d3.select("#node-mouse-over-dummy-text").remove();
              d3.select("#node-mouse-over-box").remove();
              d3.select("#node-mouse-over-actual-text").remove();
  
              nodes.attr("opacity", function(d) {
                return d.opacity;
              });
              nodes_acquired.attr("opacity", function(d) {
                return d.opacity;
              });
            }
            function save_split() {
              for (let i = 0; i < chartPieData.length; i++) {
                setTimeout(function() {
                  var selection =
                    "#background-segment-" +
                    chartPieData[i].data.value.key
                      .replace(/ /g, "-")
                      .replace(/&/g, "and");
                  var tmp_width =
                    d3
                      .select(selection)
                      .node()
                      .getBoundingClientRect().width + 100;
                  var tmp_height =
                    d3
                      .select(selection)
                      .node()
                      .getBoundingClientRect().height + 100;
  
                  var tmp_svg = d3
                    .select("#tmp-container")
                    .append("svg")
                    .attr("width", tmp_width)
                    .attr("height", tmp_height);
  
                    if (i === 0) {
                        var hor = tmp_width - 240;
                        var ver = tmp_height - 0;
                      }
                      if (i === 1) {
                        var hor = tmp_width - 340;
                        var ver = tmp_height + 20;
                      }
                      if (i === 2) {
                        var hor = tmp_width - 350;
                        var ver = tmp_height - 250;
                      }
                      if (i === 3) {
                        var hor = tmp_width - 200;
                        var ver = tmp_height - 50;
                      }
                      if (i === 4) {
                        var hor = tmp_width - 50;
                        var ver = tmp_height - 325;
                      }
                      if (i === 5) {
                        var hor = tmp_width - 200;
                        var ver = tmp_height - 375;
                      }
                      if (i === 6) {
                        var hor = tmp_width - 75;
                        var ver = tmp_height - 375;
                      }
                      if (i === 7) {
                        var hor = tmp_width - 25;
                        var ver = tmp_height - 325;
                      }
                      if (i === 8) {
                        var hor = tmp_width - 0;
                        var ver = tmp_height - 200;
                      }
                      if (i === 9) {
                        var hor = tmp_width - 25;
                        var ver = tmp_height - 75;
                      }
                      if (i === 10) {
                        var hor = tmp_width - 25;
                        var ver = tmp_height - 25;
                      }
                      if (i === 11) {
                        var hor = tmp_width - 25;
                        var ver = tmp_height - 25;
                      }
  
                  var tmp_chartSVG = tmp_svg
                    .append("g")
                    .attr("transform", "translate(" + hor + "," + ver + ")");
  
                  if (radial === "maturity") {
                    var tmp_existingSegments = tmp_chartSVG
                      .selectAll("existing-segments")
                      .data([chartPieData[i]])
                      .enter()
                      .append("path")
                      .style("fill-opacity", 1)
                      .attr("class", function(d) {
                        return (
                          "segments segment-" +
                          d.data.value.key.replace(/ /g, "-").replace(/&/g, "and")
                        );
                      })
                      .attr("id", function(d) {
                        return (
                          "tmp-existing-segment-" +
                          d.data.value.key.replace(/ /g, "-").replace(/&/g, "and")
                        );
                      })
                      .style("stroke", "white")
                      .style("stroke-width", "2px")
                      .attr("fill", "#F4F4F4") //F4F4F4
                      .attr("d", existingArc);
                  }

            var tmpSegmentsLabelBand = tmp_chartSVG
              .selectAll("path.segment-band")
              .data([chartPieData[i]])
              .enter()
              .append("path")
              .classed("segment-band", true)
              .attr("d", segmentLabelBandArc)
              .attr("id", function(d) {
                return (
                  d.data.value.key.toLowerCase().replace(/ /g, "-") + "-band"
                );
              })
              .attr("fill", "#82ADBD")
              .each(function(d, i) {
                var firstArcSection = /(^.+?)L/;
                var newArc = firstArcSection.exec(d3.select(this).attr("d"))[1];
                d.newArc = newArc.replace(/,/g, " ");
                d.percentage =
                  ((d.endAngle - d.startAngle) / 2 + d.startAngle) / 0.0628319;
                if (d.percentage >= 100) {
                  d.percentage -= 100;
                }
                if (d.percentage >= 25 && d.percentage <= 75) {
                  var startLoc = /M(.*?)A/;
                  var middleLoc = /A(.*?)0 0 1/;
                  var endLoc = /0 0 1 (.*?)$/;
                  d.newStart = endLoc.exec(d.newArc)[1];
                  d.newEnd = startLoc.exec(d.newArc)[1];
                  d.middleSec = middleLoc.exec(d.newArc)[1];
                  d.newArc =
                    "M" + d.newStart + "A" + d.middleSec + "0 0 0 " + d.newEnd;
                }
                d.hiddenArc = tmp_chartSVG
                  .append("path")
                  .attr("class", "hiddenDonutArcs")
                  .attr("id", function() {
                    return (
                      "tmp-hidden-opp-space-band-" + d.data.value.key.toLowerCase().replace(/ /g,"-")
                    );
                  })
                  .attr("d", d.newArc)
                  .style("fill", "none");
              })

              var tmpOppSpaceLabels = tmp_chartSVG
                .selectAll(".opp-space-label-text")
                .data([chartPieData[i]])
                .enter()
                .append("g")
                .selectAll(".test-class")
                .data(function(d) {
                  var limit = labelFontData.limit;

                  return textWrap(
                    d.data.value.key.toUpperCase(),
                    d.percentage,
                    limit
                  );
                })
                .enter()
                .append("text")
                .attr("class", "label opp-space-label-text")
                .attr("dy", function(d, i) {
                  if (d.percentage >= 25 && d.percentage <= 75) {
                    if (d.lineLength === 1) {
                      return "-1em";
                    } else {
                      if (i === 0) {
                        return "-2.6em";
                      } else {
                        return "-1.3em";
                      }
                    }
                  } else {
                    if (d.lineLength === 1) {
                      return "1.7em";
                    } else {
                      if (i === 0) {
                        return "2.1em";
                      } else {
                        return "3.3em";
                      }
                    }
                  }
                })
                .append("textPath")
                .attr("xlink:href", function(d, i) {
                  return (
                    "#" +
                    "tmp-hidden-opp-space-band-" +
                    d.text_data.toLowerCase().replace(/ /g,"-")
                  );
                })
                .attr("startOffset", "50%")
                .text(function(d) {
                  return d.data
                });  


            console.log('chartPieData[i].data.value.key', chartPieData[i].data.value.key)
  
  
            var tmp_nodes = tmp_chartSVG
              .selectAll("nodes")
              .data(data)
              .enter()
              .append("a")
              .attr("xlink:href", function(d) {
                return formatURL(d.Website)
              })
              .attr("target", "_blank")
              .append("image")
              .style("display", function(d) {
                console.log(d["Theme"])
                if (d["Theme"] === chartPieData[i].data.value.key) {
                  return ""
                } else {
                  return "none"
                }
              })
              .attr("class", "nodes")
              .attr("x", function(d) {
                return d.x;
              })
              .attr("y", function(d) {
                return d.y;
              })
              .attr("xlink:href", function(d) {
                return (d["Logo (source)"])
              })
              .attr("width", function(d) {
                return 40
              })
  
                  var name = chartPieData[i].data.value.key;
  
                  var svgString = getSVGString(tmp_svg.node());
  
                  svgString2Image(
                    svgString,
                    tmp_width * 2,
                    tmp_height * 2,
                    "png",
                    name,
                    save
                  );
  
                  function save(dataBlob, filesize, name) {
                    saveAs(dataBlob, "radar " + name + ".png");
                  }
  
                  //tmp_svg.remove();
                }, 1500 * i);
              }
            }



  

  
            // Set-up the export button
            d3.select("#save-button").on("click", function() {
              save_split();
  
              var svgString = getSVGString(svg.node());
              var name = "";
  
              svgString2Image(
                svgString,
                width * 2,
                height * 2,
                "png",
                name,
                save
              );
  
              function save(dataBlob, filesize, name) {
                saveAs(dataBlob, "radar.png");
              }
              // passes Blob and filesize String to the callback
            });
  
            // Below are the functions that handle actual exporting:
            // getSVGString ( svgNode ) and svgString2Image( svgString, width, height, format, callback )
            function getSVGString(svgNode) {
              svgNode.setAttribute("xlink", "http://www.w3.org/1999/xlink");
              var cssStyleText = getCSSStyles(svgNode);
              appendCSS(cssStyleText, svgNode);
  
              var serializer = new XMLSerializer();
              var svgString = serializer.serializeToString(svgNode);
              svgString = svgString.replace(/(\w+)?:?xlink=/g, "xmlns:xlink=");
              svgString = svgString.replace(/NS\d+:href/g, "xlink:href");
              svgString = svgString.replace(/"Graphik Regular";/g, "arial;");
              svgString = svgString.replace(/"Graphik Bold";/g, "arial;");
  
              return svgString;
  
              function getCSSStyles(parentElement) {
                var selectorTextArr = [];
  
                // Add Parent element Id and Classes to the list
                selectorTextArr.push("#" + parentElement.id);
                for (var c = 0; c < parentElement.classList.length; c++)
                  if (
                    !contains("." + parentElement.classList[c], selectorTextArr)
                  )
                    selectorTextArr.push("." + parentElement.classList[c]);
  
                // Add Children element Ids and Classes to the list
                var nodes = parentElement.getElementsByTagName("*");
                for (var i = 0; i < nodes.length; i++) {
                  var id = nodes[i].id;
  
                  if (!contains("#" + id, selectorTextArr))
                    selectorTextArr.push("#" + id);
  
                  var classes = nodes[i].classList;
                  for (var c = 0; c < classes.length; c++)
                    if (!contains("." + classes[c], selectorTextArr))
                      selectorTextArr.push("." + classes[c]);
                }
                // Extract CSS Rules
                var extractedCSSText = "";
                for (var i = 0; i < document.styleSheets.length; i++) {
                  var s = document.styleSheets[i];
  
                  try {
                    if (!s.cssRules) continue;
                  } catch (e) {
                    if (e.name !== "SecurityError") throw e;
                    continue;
                  }
  
                  var cssRules = s.cssRules;
  
                  //manually add css rules:
                  selectorTextArr.push("textPath");
  
                  for (var r = 0; r < cssRules.length; r++) {
                    if (contains(cssRules[r].selectorText, selectorTextArr))
                      extractedCSSText += cssRules[r].cssText;
                  }
                }
  
                return extractedCSSText;
  
                function contains(str, arr) {
                  return arr.indexOf(str) === -1 ? false : true;
                }
              }
  
              function appendCSS(cssText, element) {
                var styleElement = document.createElement("style");
                styleElement.setAttribute("type", "text/css");
                styleElement.innerHTML = cssText;
                var refNode = element.hasChildNodes()
                  ? element.children[0]
                  : null;
                element.insertBefore(styleElement, refNode);
              }
            }
          
        })
  

  
        function round_to_precision(x, precision) {
          var y = +x + (precision === undefined ? 0.5 : precision / 2);
          return y - (y % (precision === undefined ? 1 : +precision));
        }
  
        const capitalize_word = s => {
          if (typeof s !== "string") return "";
          return s.charAt(0).toUpperCase() + s.slice(1);
        };
  
        function capitalize_sentence(string) {
          var res = string.split(" ");
          result_list = [];
          for (i = 0; i < res.length; i++) {
            result_list.push(capitalize_word(res[i]));
          }
          return result_list.join(" ");
        }
  
        function formatFunding(total_funding) {
          fundingFormatted = total_funding;
          if (total_funding <= 900000 && total_funding > 1000) {
            fundingFormatted = Math.round(total_funding / 10) / 100 + "K";
          }
          if (total_funding > 900000) {
            fundingFormatted = Math.round(total_funding / 10000) / 100 + "M";
          }
          return fundingFormatted;
        }
  
        function hover_info(
          text_data,
          text_title,
          funding_year,
          total_funding,
          x,
          limit = 35
        ) {
          fundingFormatted = formatFunding(total_funding);
  
          words = text_data.split(/\s+/);
          lines = [];
          current_seq_len = 0;
          current_seq = [];
          result =
            "<tspan x=" +
            x +
            " dy='0em' class='wrap-header'>" +
            text_title +
            "</tspan>" +
            "<tspan x=" +
            x +
            " dy='1.1em' class='wrap-year'>Founded: " +
            funding_year +
            "</tspan>" +
            "<tspan x=" +
            x +
            " dy='1.1em' class='wrap-year'>Total Funding: $" +
            fundingFormatted +
            "</tspan>";
          for (i = 0; i < words.length; i++) {
            current_seq_len += words[i].length;
            current_seq.push(words[i].replace(/�۪/g, "'"));
            if (current_seq_len > limit) {
              lines.push(current_seq);
              current_seq_len = 0;
              current_seq = [];
            }
          }
          lines.push(current_seq);
          for (i = 0; i < lines.length; i++) {
            tmp = "";
            for (j = 0; j < lines[i].length; j++) {
              if (j !== lines[i].length - 1) {
                tmp += lines[i][j] + " ";
              } else {
                tmp += lines[i][j];
              }
            }
            result += "<tspan x=" + x + " dy='1.1em'>" + tmp + "</tspan>";
          }
          return result;
        }
  
        function label_wrap(text_data, limit = 7) {
          words = text_data.split(/\s+/);
          lines = [];
          current_seq_len = 0;
          current_seq = [];
          result = [];
          for (i = 0; i < words.length; i++) {
            current_seq_len += words[i].length;
            current_seq.push(words[i].replace(/�۪/g, "'"));
            if (current_seq_len > limit) {
              lines.push(current_seq);
              current_seq_len = 0;
              current_seq = [];
            }
          }
          lines.push(current_seq);
          for (i = 0; i < lines.length; i++) {
            tmp = "";
            for (j = 0; j < lines[i].length; j++) {
              if (j !== lines[i].length - 1) {
                tmp += lines[i][j] + " ";
              } else {
                tmp += lines[i][j];
              }
            }
            var dx = -tmp.length + "em";
            result.push(tmp);
          }
          return result;
        }
  
        function svgString2Image(
          svgString,
          width,
          height,
          format,
          name,
          callback
        ) {
          var format = format ? format : "png";
  
          var imgsrc =
            "data:image/svg+xml;base64," +
            btoa(unescape(encodeURIComponent(svgString)));
  
          var canvas = document.createElement("canvas");
          var context = canvas.getContext("2d");
  
          canvas.width = width;
          canvas.height = height;
  
          var image = new Image();
          image.onload = function() {
            context.clearRect(0, 0, width, height);
            context.drawImage(image, 0, 0, width, height);
  
            canvas.toBlob(function(blob) {
              var filesize = Math.round(blob.length / 1024) + " KB";
              if (callback) callback(blob, filesize, name);
            });
          };
  
          image.src = imgsrc;
        }

        function calcCongestion(
          tmp_startAngleMin,
          tmp_endAngleMax,
          tmp_innerRadiusMin,
          tmp_outerRadiusMax,
          radiusSize=2,
          numNodes
        ) {
          // calculate area of arc
          var areaA = Math.PI * (tmp_outerRadiusMax**2) * (tmp_endAngleMax - tmp_startAngleMin) / 6.28319
          var areaB = Math.PI * (tmp_innerRadiusMin**2) * (tmp_endAngleMax - tmp_startAngleMin) / 6.28319
          var area = areaA - areaB
          
          // divide by area of circle * numNodes
          var areaNode = Math.PI * (radiusSize**2)

          // High is lots of space, low is less space.
          return area / (areaNode * numNodes) 
        }

        function assignNonRandomYear(
          data,
          tmp_startAngleMin,
          tmp_endAngleMax,
          tmp_innerRadiusMin,
          tmp_outerRadiusMax,
          nodeDataEntry
        ) {
            var numNodes = nodeDataEntry.value
            var horizontalCuts = numNodes/2
            var verticalCuts = 2
            var totalSpots = numNodes

          vertDivision = (tmp_outerRadiusMax - tmp_innerRadiusMin) / verticalCuts
          horDivision = (tmp_endAngleMax - tmp_startAngleMin) / horizontalCuts

          horizontalSlot = 0
          verticalSlot = 0
          index = 0
          loop0:
          for (let vi = 0; vi <= verticalCuts; vi++) {
            loop1:
            for (let hi = 0; hi <= horizontalCuts; hi++) {
              index ++
            if (index === indexTrackerYear[data["Opportunity space"]][data["Founded"]]["slot"]) {
              horizontalSlot = hi
              verticalSlot = vi
              break loop0
            }  
            }
          }
          tmp_innerRadius = tmp_innerRadiusMin + verticalSlot * vertDivision
          tmp_outerRadius = tmp_innerRadius + vertDivision
          tmp_startAngle = tmp_startAngleMin + horizontalSlot * horDivision
          tmp_endAngle = tmp_startAngle + horDivision

          tmp_gen = d3
            .arc()
            .innerRadius(tmp_innerRadius)
            .outerRadius(tmp_outerRadius)
            .startAngle(tmp_startAngle)
            .endAngle(tmp_endAngle);

          tmp_x = tmp_gen.centroid()[0];
          tmp_y = tmp_gen.centroid()[1];

          return [tmp_x, tmp_y];
        }

        function assignNonRandom(
          data,
          tmp_startAngleMin,
          tmp_endAngleMax,
          tmp_innerRadiusMin,
          tmp_outerRadiusMax,
          nodeDataEntry) {
            // divide space into a grid?
            // half till ~number of nodes?
            var numNodes = nodeDataEntry.value
            var horizontalCuts = 0
            var verticalCuts = 0
                 
            for (let o = 0; o < numNodes; o++) {
              if (o % 2 == 0) {
                horizontalCuts++
              } else {
                verticalCuts++
              }
              var totalSpots = horizontalCuts * verticalCuts
              if (totalSpots > numNodes) {
                break;
              }
            }

          vertDivision = (tmp_outerRadiusMax - tmp_innerRadiusMin) / verticalCuts
          horDivision = (tmp_endAngleMax - tmp_startAngleMin) / horizontalCuts

          horizontalSlot = 0
          verticalSlot = 0
          index = 0
          loop0:
          for (let vi = 0; vi <= verticalCuts; vi++) {
            loop1:
            for (let hi = 0; hi <= horizontalCuts; hi++) {
              index ++
            if (index === indexTracker[data["Opportunity space"]][data["Maturity"]]["slot"]) {
              horizontalSlot = hi
              verticalSlot = vi
              break loop0
            }
            
            }
          }

          tmp_innerRadius = tmp_innerRadiusMin + verticalSlot * vertDivision
          tmp_outerRadius = tmp_innerRadius + vertDivision
          tmp_startAngle = tmp_startAngleMin + horizontalSlot * horDivision
          tmp_endAngle = tmp_startAngle + horDivision

          tmp_gen = d3
            .arc()
            .innerRadius(tmp_innerRadius)
            .outerRadius(tmp_outerRadius)
            .startAngle(tmp_startAngle)
            .endAngle(tmp_endAngle);

          tmp_x = tmp_gen.centroid()[0];
          tmp_y = tmp_gen.centroid()[1];

          return [tmp_x, tmp_y];

          }
  
        function assignRandom(
          tmp_startAngleMin,
          tmp_endAngleMax,
          tmp_innerRadiusMin,
          tmp_outerRadiusMax,
          congestion,
          nodeList
        ) {
          tmp_startAngle =
            Math.random() * (tmp_endAngleMax - tmp_startAngleMin) +
            tmp_startAngleMin;
          tmp_endAngle =
            Math.random() * (tmp_endAngleMax - tmp_startAngle) + tmp_startAngle;
          tmp_innerRadius =
            Math.random() * (tmp_outerRadiusMax - tmp_innerRadiusMin) +
            tmp_innerRadiusMin;
          tmp_outerRadius =
            Math.random() * (tmp_outerRadiusMax - tmp_innerRadius) +
            tmp_innerRadius;
          tmp_gen = d3
            .arc()
            .innerRadius(tmp_innerRadius)
            .outerRadius(tmp_outerRadius)
            .startAngle(tmp_startAngle)
            .endAngle(tmp_endAngle );
  
          tmp_x = tmp_gen.centroid()[0];
          tmp_y = tmp_gen.centroid()[1];
  
          if (nodeList.length !== 0) {
            var distanceCheck = 0;
            for (l = 0; l < nodeList.length; l++) {
              distance = Math.sqrt(
                Math.pow(nodeList[l][0] - tmp_x, 2) +
                  Math.pow(nodeList[l][1] - tmp_y, 2)
              );
              if (distance <= 30) {
                distanceCheck = 1;
              }
            }
            if (distanceCheck === 1) {
              return assignRandom(
                tmp_startAngleMin,
                tmp_endAngleMax,
                tmp_innerRadiusMin,
                tmp_outerRadiusMax,
                congestion,
                nodeList
              );
            } else {
              nodeList.push([tmp_x, tmp_y]);
              return [tmp_x, tmp_y];
            }
          } else {
            nodeList.push([tmp_x, tmp_y]);
            return [tmp_x, tmp_y];
          }
        }
      </script>
  
  </body>
</html>
